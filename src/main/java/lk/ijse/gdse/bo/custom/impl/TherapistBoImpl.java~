package lk.ijse.gdse.bo.custom.impl;

import lk.ijse.gdse.bo.custom.TherapistBo;
import lk.ijse.gdse.dao.DaoFactory;
import lk.ijse.gdse.dao.custom.TherapistDao;
import lk.ijse.gdse.dto.TherapistDto;
import lk.ijse.gdse.dto.UserDto;
import lk.ijse.gdse.entity.Therapist;
import lk.ijse.gdse.entity.User;

import java.sql.SQLException;
import java.util.ArrayList;

public class TherapistBoImpl implements TherapistBo {

    TherapistDao therapistDao = DaoFactory.getInstance().getDao(DaoFactory.DaoType.THERAPIST);

    @Override
    public String getNextId() throws SQLException {
        String id = therapistDao.getNextId();

        if (id != null) {
            String substring = id.substring(1);
            int i = Integer.parseInt(substring);
            int newIdIndex = i + 1;
            return String.format("T%03d", newIdIndex);
        }
        return "T001";
    }

    @Override
    public ArrayList<TherapistDto> getAll() throws SQLException {

        ArrayList<Therapist> therapists = therapistDao.getAll();

        ArrayList<TherapistDto> therapistDtos = new ArrayList<>();

        for (Therapist therapist : therapists) {
            therapistDtos.add(new TherapistDto(
                    therapist.getId(),
                    therapist.getName(),
                    therapist.getEmail(),
                    therapist.getContact()
            ));
        }

        return therapistDtos;
    }

    @Override
    public boolean save(TherapistDto therapistDto) throws SQLException {
        Therapist therapist = new Therapist();
        therapist.setId(therapistDto.getId());
        therapist.setName(therapistDto.getName());
        therapist.setEmail(therapistDto.getEmail());
        therapist.setContact(therapistDto.getContact());

        return therapistDao.save(therapist);

    }

    @Override
    public boolean delete(String Id) throws SQLException {
        return therapistDao.delete(Id);
    }

    @Override
    public boolean update(TherapistDto therapistDto) throws SQLException {
        Therapist therapist = new Therapist();
        therapist.setId(therapistDto.getId());
        therapist.setName(therapistDto.getName());
        therapist.setEmail(therapistDto.getEmail());
        therapist.setContact(therapistDto.getContact());

        return therapistDao.update(therapist);
    }

    @Override
    public TherapistDto findByName(String therapistName) {
        Therapist therapist = therapistDao.findByName(therapistName);

        if (therapist == null){

        }

        return new TherapistDto(therapist.getId(), therapist.getName(), therapist.getEmail(), therapist.getContact());
    }
}
